---
title: "Geography of Covid Vaccine Hesitancy in the U.S. "
author: "Ava Podell"
date: "5/18/21"
output:
  rmdformats::readthedown:
    thumbnails: false
    highlight: NULL
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align="center")
#options(plot.width = width, repr.plot.height = height)
library(tidyverse)
library(datasets)
library(viridis)
library(maps)
library(leaflet)
library("readxl")
library(shiny)
library(shinyWidgets)
library(ggplot2)
library(fiftystater)
library(dplyr)
library(tidyr)
library(stringr)
library(mapproj)
options(scipen = 999)
my_data <- read_excel("county_week26_data_fixed.xlsx", na = "NA")
census <- read_excel("census_est_tab.xlsx", na = "NA")
usa_states <- map_data(map = "state", region = ".") 
```

![Vaccine Line in Boston Massachusets, March 2021](https://bostonglobe-prod.cdn.arcpublishing.com/resizer/W-xCu9AyrlXYOBz5z64krF4bnXU=/1440x0/cloudfront-us-east-1.images.arcpublishing.com/bostonglobe/Q3NX5G4PELPYDJ5C7AWWCGNZ4Y.jpg)

# Introduction 

Back in March, I created my PUG Shiny project with a focus on COVID vaccine distribution. At the time, the issue facing the united states was primarily one of distribution: people who wanted the vaccine couldn't get it. Eligibility was restricted state by state to allocate a precious resource. Even people who were eligible needed to get lucky and navigate online sign up forms, vouching for fewer spots than people. Here's my Shiny App, improved and updated with the latest data:


<iframe height="700" width="100%" frameborder="no" src="https://apodell.shinyapps.io/updatedShinyPug/"> </iframe>`

## Motivation
Over the past six weeks, the supply chain has greatly improved, and access is no longer such a pressing issue. The issues facing the country have evolved: the issue now is acheiving heard immunity, and getting everyone vaccinated. In March, I didn't know anyone who had gotten a vaccine. But now in April, I don't know anyone who __hasn't__ gotten one. I wanted to map out where in the country people are the most hesitant to get vaccinated. Knowing the most resistant geographies could be useful information for government organizations to focus their vaccine advocacy efforts.


![Anti-Vax Protesters in Texas](https://thumbnails.texastribune.org/cSUakDZ0lGgZjdfZwOOQIjqocDc=/2500x1675/smart/filters:quality(75)/https://static.texastribune.org/media/files/13908c124949f4dd2f526d59a8492c6e/Reopen%20Texas%20Protest%20JV%20TT%2005.jpg)



# Working with Public Health Data Sets

## Inter-Agency Knowledge Sharing

I investigated a CDC published dataset titled ["Vaccine Hesitancy for COVID-19: County and local estimates."](https://data.cdc.gov/Vaccinations/Vaccine-Hesitancy-for-COVID-19-County-and-local-es/q9mh-h2tw) The dataset comes from [a publication by the ASPE](https://aspe.hhs.gov/pdf-report/vaccine-hesitancy), the Office of the Assistant Secretary for Planning and Evaluation, of the U.S. Department of Health and Human Services. Specifically, the data was collected via the [U.S. Census Bureau's Household Pulse Survey](https://www.census.gov/data/tables/2021/demo/hhp/hhp28.html), 2021 Week 28, April 14-26. 


## Variables of Interest

The dataset contained several demographic variables measured for each U.S. county. The variables of interest for this project are  *"Estimated Hesitant"* and *"Estimated Strongly Hesitant"*, which measure the percent of adults in each county who indicated they are either __hesitant__, or __strongly hesitant__, respectively, to get vaccinated. Due to the phrasing of the variable description, I assume that survey respondents who indicated either "Hesitant" or "Strongly Hesitant" are all adults who have not yet received a covid vaccine. You can check out the ASPE's methodology for these estimates [here](https://aspe.hhs.gov/system/files/pdf/265341/vaccine-hesitancy-COVID-19-Methodology.pdf). 

## Data Wrangling {.tabset .tabset-fade .tabset-pills}

### Fauci with a headache, or ... 
![fauchi](https://media.giphy.com/media/JmD9mkDmzvXE7nxy7j/giphy.gif)

### Data Wrangling

#### First, I cleaned up the CDC dataset: 

```{r, message=FALSE, warning=FALSE}
my_data0 <- my_data %>%
  #select columns relevant to my investigation
  select(c("County Name","State","Estimated hesitant", "Estimated strongly hesitant","Social Vulnerability Index (SVI)","SVI Category","Ability to handle a COVID-19 outbreak (CVAC)","CVAC Category","Percent adults fully vaccinated against COVID-19 as of 3/30/2021"))%>%
  
  #change names to lowercase for easy merging with map dataset
  mutate(State = tolower(State), `County Name` = tolower(`County Name`))%>%
  
  #rename columns to r-friendly names
  rename(region = State, subregion = `County Name`) %>%
  rename(est_hesitant = "Estimated hesitant")%>%
  rename(est_strong_hesitant = "Estimated strongly hesitant")%>%
  rename(svi_cat = "SVI Category"  )%>%
  rename(svi = "Social Vulnerability Index (SVI)"  )%>%
  rename(pct_full_vaxed = "Percent adults fully vaccinated against COVID-19 as of 3/30/2021")

 #edit subregion (county name) values to match their equivs in map dataset
 my_data0$subregion <- str_remove(my_data0$subregion, " county.*")
 my_data0$subregion <- str_remove(my_data0$subregion, ",.*")
```

#### Then, I added mapping capabilites by merging `my_data0` with the `usa_counties` dataset

```{r}
usa_counties <- map_data(map = "county", region = ".")

my_data0_map <- my_data0 %>%
  inner_join(usa_counties, by =c("subregion", "region"))
```



# Mapping County-Level Vaccine Hesitancy {.tabset .tabset-fade .tabset-pills}

## Hesitancy Map

```{r,echo= FALSE}
ggplot(my_data0_map, aes(x = long, y = lat, group = group, fill = est_hesitant)) +
  geom_polygon(color = "white", size = 0.05) +
  theme_void() +
  coord_fixed(ratio = 1.3) +
  labs(fill = "Proportion of residents hesitant to be vaccinated") +
  theme(legend.position="bottom")+
  scale_fill_distiller(palette = "Spectral")
```

## __Strong__ Hesitancy Map

```{r, echo= FALSE}
ggplot(my_data0_map, aes(x = long, y = lat, group = group, fill = est_strong_hesitant)) +
  geom_polygon(color = "white", size = 0.05) +
  theme_void() +
  coord_fixed(ratio = 1.3) +
  labs(fill = "Proportion of residents STRONGLY hesitant to be vaccinated") +
  theme(legend.position="bottom")+
  scale_fill_distiller(palette = "Spectral")
```

## The Code behind it all

Mapping of County Vaccine "Hesitancy" Rates

```{r,eval= FALSE}
ggplot(my_data0_map, aes(x = long, y = lat, group = group, fill = est_hesitant)) +
  geom_polygon(color = "white", size = 0.05) +
  theme_void() +
  coord_fixed(ratio = 1.3) +
  labs(fill = "Proportion of residents hesitant to be vaccinated") +
  theme(legend.position="bottom")+
  scale_fill_distiller(palette = "Spectral")
```

Mapping of strong hesitancy

```{r, eval=FALSE}
ggplot(my_data0_map, aes(x = long, y = lat, group = group, fill = est_strong_hesitant)) +
  geom_polygon(color = "white", size = 0.05) +
  theme_void() +
  coord_fixed(ratio = 1.3) +
  labs(fill = "Proportion of residents STRONGLY hesitant to be vaccinated") +
  theme(legend.position="bottom")+
  scale_fill_distiller(palette = "Spectral")
```







# H1: Analysis of Maps

I observe a striking visual pattern in the mapping of county hesitancy levels. In many places on the map, we see areas that dont
### H3: zooming in on distinct areas
# ```{r midwest}
# ggplot() +
#   geom_polygon(data = my_data0_map, aes(x = long, y = lat, group = group, fill = est_strong_hesitant), color = "white", size = 0.05) +
#   geom_polygon(data = usa_states, aes(x = long, y = lat, group = group),fill="NA", colour = "black") +
#   theme_void() +
#   coord_fixed(xlim = c(-110, -90),  ylim = c(42, 50), ratio = 1.3) +
#   labs(fill = "Proportion of residents STRONGLY hesitant to be vaccinated") +
#   theme(legend.position="bottom")+
#   scale_fill_distiller(palette = "Spectral")  
#    # remove legend!
#   guides(fill = FALSE)
# ```

# ```{r tenn}
# ggplot() +
#   geom_polygon(data = my_data0_map, aes(x = long, y = lat, group = group, fill = est_hesitant), color = "white", size = 0.05) +
#   geom_polygon(data = usa_states, aes(x = long, y = lat, group = group),fill="NA", colour = "black") +
#   theme_void() +
#   coord_fixed(xlim = c(-95, -75),  ylim = c(30, 40), ratio = 1.3) +
#   labs(fill = "Proportion of residents STRONGLY hesitant to be vaccinated") +
#   theme(legend.position="bottom")+
#   scale_fill_distiller(palette = "Spectral")  
#    # remove legend!
#   guides(fill = FALSE)
# ```


IDK yet but theres something about how state lines really impact fill. I ran a cluser analysis to see if I was making this trend up or not

Try out clustering
# ```{r, warning=FALSE, message=FALSE}
# my_data0_map_cluster <- my_data0_map %>%
#   select(est_hesitant, long, lat)
# 
# 
# set.seed(15)
# library(mclust)
# county_clusts <- my_data0_map_cluster %>%
#   kmeans(centers = 48)%>%
#   fitted("classes")%>%
#   as.character()
# 
# my_data0_map_cluster <- my_data0_map_cluster %>% mutate(cluster = county_clusts)
# 
# my_data0_map_cluster %>% ggplot(aes(x = long, y = lat)) +
#   geom_point(aes(color = cluster), alpha = 0.5)+
#   coord_fixed(ratio = 1.3)
# ```

# ```{r, echo=FALSE}
# #usa_states <- map_data(map = "state", region = ".") 
# 
# ggplot()+
#   geom_point(data = my_data0_map_cluster, aes(x = long, y = lat, color = cluster), alpha = 0.5)+
#   geom_polygon(data = usa_states, aes(x = long, y = lat, group = group),fill="NA", colour = "black") +
#   theme_void()+
#   theme(legend.position="none")
# ```




# Conclusion

My conclusion blah blah blah

## Sources used in this project

<!-- full map page on cdc data site -->
- [https://data.cdc.gov/stories/s/Vaccine-Hesitancy-for-COVID-19/cnd2-a6zw/](https://data.cdc.gov/stories/s/Vaccine-Hesitancy-for-COVID-19/cnd2-a6zw/)
<!-- actual dataset link -->
- [https://data.cdc.gov/Vaccinations/Vaccine-Hesitancy-for-COVID-19-County-and-local-es/q9mh-h2tw](https://data.cdc.gov/Vaccinations/Vaccine-Hesitancy-for-COVID-19-County-and-local-es/q9mh-h2tw)
<!-- actual aspe site -->
- [https://aspe.hhs.gov/pdf-report/vaccine-hesitancy](https://aspe.hhs.gov/pdf-report/vaccine-hesitancy)
- [methodology](https://aspe.hhs.gov/system/files/pdf/265341/vaccine-hesitancy-COVID-19-Methodology.pdf)



